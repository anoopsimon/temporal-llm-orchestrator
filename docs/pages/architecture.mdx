---
title: Architecture
description: Components, responsibilities, and data boundaries
---

# Architecture

## High Level Components

```text
Client -> HTTP API (chi)
           |
           v
       Temporal Workflow
           |
           +--> Activities (network + IO)
                   |
                   +--> OpenAI API
                   +--> Postgres
                   +--> MinIO
```

## Why This Split Exists

Temporal workflows must be deterministic. All non-deterministic operations are pushed to activities.

- Workflow code decides control flow only
- Activities perform side effects

That split is implemented in:

- `internal/temporal/workflows.go`
- `internal/temporal/activities.go`

## Storage Model

### Postgres

Tables in `db/migrations/001_init.sql`:

- `documents`: status + extracted payloads
- `extraction_attempts`: raw model outputs by phase
- `audit_log`: state transitions
- `review_queue`: pending human review work

### MinIO

Raw uploaded files are stored in object storage via `internal/storage/minio.go`.

## API to Workflow Boundary

Entry endpoint `POST /v1/documents` in `internal/api/handlers.go`:

1. Persist received record
2. Start Temporal workflow with `documentId`, filename, and content
3. Return accepted response with `document_id`

## Domain Boundary

- Schemas and extraction structs: `internal/domain/models.go`
- Validation rules: `internal/domain/validation.go`
- States and decisions: `internal/domain/state.go`

> **Note**
> The architecture is optimized for reliability and auditability under uncertain model behavior.
