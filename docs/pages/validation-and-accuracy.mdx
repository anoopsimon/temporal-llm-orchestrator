---
title: Validation and Accuracy
description: Rule validation, confidence thresholds, and low confidence behavior
---

# Validation and Accuracy

## What accuracy means here

This system uses two layers:

1. Structural correctness (JSON parse + schema keys)
2. Domain correctness (business rule validation + confidence threshold)

Both must pass to auto-complete.

## Rule checks

Implemented in `internal/domain/validation.go`.

### Payslip rules

- `gross_pay >= net_pay`
- all amounts non-negative
- pay period dates parseable and ordered
- confidence in range `0..1`

### Invoice rules

- `total_amount > 0`
- amounts non-negative
- invoice and due date parseability
- confidence in range `0..1`

## Confidence threshold

Workflow threshold is `0.75`.

If confidence `< 0.75`:

1. one correction attempt via Prompt Set C
2. re-validate
3. if still `< 0.75`, route to `NEEDS_REVIEW`

Reference:

- `internal/temporal/workflows.go`

## What happens when accuracy is low

Low confidence is treated as a quality failure, not a soft warning.

```text
low confidence -> correction attempt -> still low -> human review queue
```

This prevents low-quality automation from writing final output without oversight.

<details>
<summary><strong>How to tune quality over time</strong></summary>

Use `extraction_attempts` and `audit_log` to build error dashboards:

- parse failures by doc type
- rule failure frequency by field
- confidence distribution
- reviewer correction patterns

These signals can drive prompt refinements and schema evolution.

</details>
