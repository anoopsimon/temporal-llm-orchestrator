<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="980" viewBox="0 0 1600 980" role="img" aria-labelledby="title desc">
  <title id="title">AI Intake Event-Driven Architecture</title>
  <desc id="desc">User uploads text to API, API stores in MinIO, event-handler starts Temporal workflow, worker executes activities, calls OpenAI, and persists to Postgres. Reviewers send decisions via API as Temporal signals.</desc>

  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#f4f8ff"/>
      <stop offset="100%" stop-color="#eef7f2"/>
    </linearGradient>
    <linearGradient id="cardA" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffffff"/>
      <stop offset="100%" stop-color="#f8fbff"/>
    </linearGradient>
    <linearGradient id="cardB" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffffff"/>
      <stop offset="100%" stop-color="#f7fff9"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="160%">
      <feDropShadow dx="0" dy="6" stdDeviation="9" flood-color="#1f2937" flood-opacity="0.16"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#334155"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#0f5cad"/>
    </marker>
    <pattern id="grid" width="28" height="28" patternUnits="userSpaceOnUse">
      <path d="M 28 0 L 0 0 0 28" fill="none" stroke="#dbe4f0" stroke-width="1"/>
    </pattern>
  </defs>

  <rect x="0" y="0" width="1600" height="980" fill="url(#bg)"/>
  <rect x="0" y="0" width="1600" height="980" fill="url(#grid)" opacity="0.35"/>

  <text x="60" y="66" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="38" font-weight="700" fill="#0f172a">AI Document Intake - Event-Driven Runtime</text>
  <text x="60" y="98" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="18" fill="#334155">Upload -&gt; MinIO ObjectCreated -&gt; event-handler -&gt; Temporal workflow -&gt; worker activities</text>

  <rect x="60" y="128" width="300" height="34" rx="10" fill="#dbeafe"/>
  <text x="84" y="150" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" font-weight="600" fill="#1e3a8a">Ingress</text>

  <rect x="370" y="128" width="320" height="34" rx="10" fill="#dcfce7"/>
  <text x="394" y="150" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" font-weight="600" fill="#14532d">Storage + Event Source</text>

  <rect x="700" y="128" width="370" height="34" rx="10" fill="#e0e7ff"/>
  <text x="724" y="150" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" font-weight="600" fill="#312e81">Orchestration</text>

  <rect x="1080" y="128" width="460" height="34" rx="10" fill="#ffedd5"/>
  <text x="1104" y="150" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" font-weight="600" fill="#9a3412">Execution + Persistence</text>

  <g filter="url(#shadow)">
    <rect x="70" y="200" width="280" height="124" rx="20" fill="url(#cardA)" stroke="#93c5fd" stroke-width="2"/>
    <text x="98" y="244" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">User / Client</text>
    <text x="98" y="274" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">Portal upload, file drop,</text>
    <text x="98" y="297" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">or pasted email text</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="70" y="514" width="280" height="132" rx="20" fill="url(#cardA)" stroke="#f59e0b" stroke-width="2"/>
    <text x="98" y="558" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">Reviewer</text>
    <text x="98" y="588" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">Human approves, rejects,</text>
    <text x="98" y="611" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">or corrects uncertain cases</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="390" y="200" width="280" height="124" rx="20" fill="url(#cardA)" stroke="#60a5fa" stroke-width="2"/>
    <text x="418" y="245" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">API Service</text>
    <text x="418" y="274" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">POST /v1/documents</text>
    <text x="418" y="297" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">stores file in MinIO</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="390" y="514" width="280" height="132" rx="20" fill="url(#cardA)" stroke="#f59e0b" stroke-width="2"/>
    <text x="418" y="558" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">Review API</text>
    <text x="418" y="588" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">POST /v1/documents/{id}/review</text>
    <text x="418" y="611" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">sends Temporal signal</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="720" y="200" width="320" height="124" rx="20" fill="url(#cardB)" stroke="#34d399" stroke-width="2"/>
    <text x="748" y="245" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">MinIO Bucket</text>
    <text x="748" y="274" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">object key: document_id/filename</text>
    <text x="748" y="297" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">emits ObjectCreated events</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="720" y="380" width="320" height="124" rx="20" fill="url(#cardA)" stroke="#818cf8" stroke-width="2"/>
    <text x="748" y="425" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">event-handler</text>
    <text x="748" y="454" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">listens on s3:ObjectCreated:*</text>
    <text x="748" y="477" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">starts DocumentIntakeWorkflow</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="1100" y="200" width="410" height="124" rx="20" fill="url(#cardA)" stroke="#6366f1" stroke-width="2"/>
    <text x="1128" y="245" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">Temporal Workflow</text>
    <text x="1128" y="274" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">ID: doc-intake-{document_id}</text>
    <text x="1128" y="297" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">orchestrates retries + review loop</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="1100" y="380" width="410" height="248" rx="20" fill="url(#cardA)" stroke="#3b82f6" stroke-width="2"/>
    <text x="1128" y="424" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">Worker Activities</text>
    <text x="1128" y="457" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">1. StoreDocumentActivity</text>
    <text x="1128" y="480" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">2. DetectDocTypeActivity</text>
    <text x="1128" y="503" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">3. Extract / Repair / Correct (LLM)</text>
    <text x="1128" y="526" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">4. ValidateFieldsActivity</text>
    <text x="1128" y="549" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">5. PersistResult or RejectDocument</text>
    <text x="1128" y="585" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" fill="#475569">Waits for review signal when confidence is low</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="720" y="680" width="320" height="124" rx="20" fill="url(#cardA)" stroke="#8b5cf6" stroke-width="2"/>
    <text x="748" y="724" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">OpenAI API</text>
    <text x="748" y="754" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">BASE / REPAIR / CORRECT prompts</text>
    <text x="748" y="777" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">returns structured JSON</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="1100" y="680" width="410" height="124" rx="20" fill="url(#cardA)" stroke="#0ea5e9" stroke-width="2"/>
    <text x="1128" y="724" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="24" font-weight="700" fill="#0f172a">Postgres</text>
    <text x="1128" y="754" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">documents, extraction_attempts, audit_log, review_queue</text>
    <text x="1128" y="777" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="17" fill="#334155">status and result APIs read from here</text>
  </g>

  <path d="M350 262 L390 262" stroke="#334155" stroke-width="3.5" fill="none" marker-end="url(#arrow)"/>
  <path d="M670 262 L720 262" stroke="#334155" stroke-width="3.5" fill="none" marker-end="url(#arrow)"/>
  <path d="M1040 262 L1100 262" stroke="#334155" stroke-width="3.5" fill="none" marker-end="url(#arrow)"/>
  <path d="M880 324 L880 380" stroke="#0f5cad" stroke-width="3.5" fill="none" marker-end="url(#arrowBlue)"/>
  <path d="M1040 442 L1100 442" stroke="#334155" stroke-width="3.5" fill="none" marker-end="url(#arrow)"/>
  <path d="M1275 324 L1275 380" stroke="#334155" stroke-width="3.5" fill="none" marker-end="url(#arrow)"/>
  <path d="M350 580 L390 580" stroke="#334155" stroke-width="3.5" fill="none" marker-end="url(#arrow)"/>

  <path d="M670 580 C860 580, 980 580, 1275 324" stroke="#0f5cad" stroke-width="3.2" fill="none" stroke-dasharray="10 8" marker-end="url(#arrowBlue)"/>
  <text x="760" y="596" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="14" fill="#0f5cad">Temporal signal: approve / reject / correct</text>

  <path d="M1275 628 L1275 680" stroke="#334155" stroke-width="3.5" fill="none" marker-end="url(#arrow)"/>
  <path d="M1140 710 L1040 742" stroke="#334155" stroke-width="3.2" fill="none" stroke-dasharray="8 7" marker-end="url(#arrow)"/>
  <text x="940" y="732" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="14" fill="#475569">LLM calls</text>

  <path d="M1200 442 C1060 442, 980 442, 880 442" stroke="#334155" stroke-width="3.2" fill="none" stroke-dasharray="8 7" marker-end="url(#arrow)"/>
  <text x="900" y="426" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="14" fill="#475569">fetch object by key</text>

  <rect x="60" y="858" width="1480" height="76" rx="14" fill="#ffffff" stroke="#cbd5e1" stroke-width="1.5"/>
  <circle cx="92" cy="885" r="8" fill="#334155"/>
  <text x="108" y="891" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" fill="#334155">Solid arrows: synchronous request/call path</text>
  <circle cx="525" cy="885" r="8" fill="#0f5cad"/>
  <text x="541" y="891" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" fill="#334155">Blue arrows: event/signal path</text>
  <line x1="924" y1="885" x2="966" y2="885" stroke="#334155" stroke-width="3" stroke-dasharray="8 6"/>
  <text x="976" y="891" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" fill="#334155">Dashed lines: asynchronous or external calls</text>
  <text x="1320" y="891" font-family="IBM Plex Sans, Segoe UI, Arial, sans-serif" font-size="15" font-weight="600" fill="#1e293b">Current scope: UTF-8 text intake</text>
</svg>
